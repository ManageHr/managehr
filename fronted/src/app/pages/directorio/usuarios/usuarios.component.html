<app-menu></app-menu>

<div class="layout">
  <div class="contenido-principal">
    <div
      id="tituloTargetas1"
      class="header-horas d-flex justify-content-between align-items-center"
    >
      <h3>Directorio Usuarios</h3>
      <button
        class="btn btn-light btn-sm agregar-btn"
        *ngIf="[1, 4].includes(usuario?.rol)"
        data-bs-toggle="modal"
        data-bs-target="#modalReporteUsuarios"
        (click)="abrirModalReporte()"
      >
        <i class="fas fa-plus-circle"></i> Reporte Usuarios
      </button>
      <button
        class="btn btn-light btn-sm agregar-btn"
        *ngIf="[1, 4].includes(usuario?.rol)"
        (click)="abrirModalAgregar()"
      >
        <i class="fas fa-plus-circle"></i> Agregar
      </button>
    </div>

    <div *ngIf="[1, 4].includes(usuario?.rol); else sinPermiso">
      <!-- Tabla: visible en pantallas grandes -->

      <div id="tituloTargetasfiltro1" class="mb-3">
        <input
          type="text"
          class="form-control"
          placeholder="Buscar por nombre o Numero de documento..."
          style="
            background-color: #1d2233;
            color: white;
            border: 1px solid #7a86a1;
          "
          [(ngModel)]="filtroNombre"
        />
      </div>

      <div class="table-responsive d-none d-md-block">
        <table class="table table-striped table-bordered table-hover">
          <thead class="table-dark">
            <tr>
              <th>Nombre</th>
              <th>Teléfono</th>
              <th>Correo</th>
              <th>Dirección</th>
              <th>N° Documento</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let u of usuarios
                  | filterNombre : filtroNombre
                  | paginate
                    : { itemsPerPage: itemsPerPage, currentPage: currentPage };
                trackBy: trackByUsuario;
                let i = index
              "
            >
              <td>{{ nombreCompleto(u) }}</td>
              <td>{{ u.telefono }}</td>
              <td>{{ u.email }}</td>
              <td>{{ u.direccion }}</td>
              <td>{{ u.numDocumento }}</td>

              <td>
                <button
                  class="btn btn-warning btn-acciones"
                  (click)="mostrarInfoUsuario(u.usersId)"
                  *ngIf="[1, 4].includes(usuario?.rol)"
                >
                  <i class="fas fa-user-shield"></i>
                </button>
                <button
                  class="btn btn-link btn-acciones editar"
                  (click)="editarusuarios(u, i)"
                >
                  <i class="fas fa-edit"></i>
                </button>
                <button
                  class="btn btn-danger btn-acciones eliminar"
                  (click)="confirmDelete(i)"
                >
                  <i class="fas fa-trash-alt"></i>
                </button>
                <button
                  class="btn btn-link btn-acciones"
                  (click)="mostrarHojaVida(u)"
                >
                  <i class="fas fa-file-alt" title="Hoja de Vida"></i>
                </button>
                <button
                  class="btn btn-link btn-acciones"
                  (click)="verExperiencia(u)"
                >
                  <i class="fas fa-briefcase" title="Experiencia Laboral"></i>
                </button>
                <button
                  class="btn btn-link btn-acciones"
                  (click)="mostrarHasEstudios(u)"
                >
                  <i class="fas fa-graduation-cap" title="Estudios"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>

        <nav class="mt-3 d-flex justify-content-center">
          <ul class="pagination">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <button
                class="page-link"
                (click)="cambiarPagina(currentPage - 1)"
              >
                Anterior
              </button>
            </li>
            <li
              class="page-item"
              *ngFor="
                let paginas of getPaginas(currentPage, totalPagesFiltrados)
              "
              [class.active]="paginas === currentPage"
              [class.disabled]="paginas === '...'"
            >
              <button
                class="page-link"
                (click)="irAPaginaUsuarios(paginas)"
                [disabled]="paginas === '...'"
              >
                {{ paginas }}
              </button>
            </li>

            <li
              class="page-item"
              [class.disabled]="currentPage === totalPagesFiltrados"
            >
              <button
                class="page-link"
                (click)="cambiarPagina(currentPage + 1)"
              >
                Siguiente
              </button>
            </li>
          </ul>
        </nav>
      </div>
      <div
        id="tituloTargetas2"
        class="header-horas d-flex justify-content-between align-items-center"
      >
        <h3>Directorio Usuarios Externos</h3>
      </div>
      <input
        id="tituloTargetasfiltro2"
        type="text"
        class="form-control mb-2"
        style="
          background-color: #1d2233;
          color: white;
          border: 1px solid #7a86a1;
        "
        [(ngModel)]="filtroNombreExternos"
        placeholder="Buscar externo por nombre..."
      />

      <div class="table-responsive d-none d-md-block">
        <table class="table table-striped table-bordered table-hover">
          <thead class="table-dark">
            <tr>
              <th>Nombre</th>
              <th>Teléfono</th>
              <th>Correo</th>
              <th>Dirección</th>
              <th>N° Documento</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let usuarios of usuariosRolCinco
                  | filterNombre : filtroNombreExternos
                  | paginate
                    : {
                        itemsPerPage: itemsPerPage,
                        currentPage: currentPageExternos
                      };
                trackBy: trackByUsuario;
                let i = index
              "
            >
              <td>{{ nombreCompleto(usuarios) }}</td>
              <td>{{ usuarios.telefono }}</td>
              <td>{{ usuarios.email }}</td>
              <td>{{ usuarios.direccion }}</td>
              <td>{{ usuarios.numDocumento }}</td>

              <td>
                <button
                  class="btn btn-warning btn-acciones"
                  (click)="mostrarInfoUsuario(usuarios.usersId)"
                  *ngIf="[1, 4].includes(usuario?.rol)"
                >
                  <i class="fas fa-user-shield"></i>
                </button>
                <button
                  class="btn btn-link btn-acciones editar"
                  (click)="editarusuarios(usuarios, i)"
                >
                  <i class="fas fa-edit"></i>
                </button>
                <button
                  class="btn btn-danger btn-acciones eliminar"
                  (click)="confirmDelete(i)"
                >
                  <i class="fas fa-trash-alt"></i>
                </button>
                <button
                  class="btn btn-link btn-acciones"
                  (click)="mostrarHojaVida(usuarios)"
                >
                  <i class="fas fa-file-alt" title="Hoja de Vida"></i>
                </button>
                <button
                  class="btn btn-link btn-acciones"
                  (click)="verExperiencia(usuarios)"
                >
                  <i class="fas fa-briefcase" title="Experiencia Laboral"></i>
                </button>
                <button
                  class="btn btn-link btn-acciones"
                  (click)="mostrarEstudios(usuarios)"
                >
                  <i class="fas fa-graduation-cap" title="Estudios"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>

        <nav class="mt-3 d-flex justify-content-center">
          <ul class="pagination">
            <li class="page-item" [class.disabled]="currentPageExternos === 1">
              <button
                class="page-link"
                (click)="currentPageExternos = currentPageExternos - 1"
              >
                Anterior
              </button>
            </li>
            <li
              class="page-item"
              *ngFor="
                let page of getPaginas(
                  currentPageExternos,
                  totalPagesExternosFiltrados
                )
              "
              [class.active]="page === currentPageExternos"
              [class.disabled]="page === '...'"
            >
              <button
                class="page-link"
                (click)="irAPaginaExternos(page)"
                [disabled]="page === '...'"
              >
                {{ page }}
              </button>
            </li>

            <li
              class="page-item"
              [class.disabled]="
                currentPageExternos === totalPagesExternosFiltrados
              "
            >
              <button
                class="page-link"
                (click)="currentPageExternos = currentPageExternos + 1"
              >
                Siguiente
              </button>
            </li>
          </ul>
        </nav>
      </div>

      <!-- Modal usersID -->
      <!-- Modal -->
      <div
        class="modal fade show"
        tabindex="-1"
        [ngStyle]="{ display: mostrarModal ? 'block' : 'none' }"
        *ngIf="usuarioSeleccionado"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Detalles del Usuario</h5>
              <button
                type="button"
                class="btn-close"
                (click)="cerrarModal()"
              ></button>
            </div>
            <div class="modal-body">
              <p>
                <strong>Nombre:</strong> {{ usuarioSeleccionado.primerNombre }}
                {{ usuarioSeleccionado.primerApellido }}
              </p>
              <p>
                <strong>Correo:</strong> {{ usuarioSeleccionado.user?.email }}
              </p>
              <p>
                <strong>Dirección:</strong> {{ usuarioSeleccionado.direccion }}
              </p>
              <p><strong>Rol:</strong> {{ rolNombreSeleccionado }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Tarjetas: visible en pantallas pequeñas todos los usuarios -->

      <div class="d-md-none">
        <div
          id="tituloTargetas1Res"
          class="header-horas d-flex justify-content-between align-items-center"
        >
          <h3>Directorio Usuarios</h3>
          <button
            class="btn btn-light btn-sm agregar-btn"
            *ngIf="[1, 4].includes(usuario?.rol)"
            (click)="abrirModalAgregar()"
          >
            <i class="fas fa-plus-circle"></i> Agregar
          </button>
        </div>
        <input
          id="tituloTargetasfiltro1Res"
          type="text"
          class="form-control mb-3"
          placeholder="Buscar por nombre o documento..."
          style="
            background-color: #1d2233;
            color: white;
            border: 1px solid #7a86a1;
          "
          [(ngModel)]="filtroNombre"
        />
        <div class="row">
          <div
            class="col-12 mb-3"
            *ngFor="
              let u of usuarios
                | filterNombre : filtroNombre
                | paginate
                  : { itemsPerPage: itemsPerPage, currentPage: currentPage };
              trackBy: trackByUsuario;
              let i = index
            "
          >
            <div class="card border-secondary">
              <div class="card-body">
                <p><strong>Nombre:</strong> {{ nombreCompleto(u) }}</p>
                <p><strong>Teléfono:</strong> {{ u.telefono }}</p>
                <p><strong>Correo:</strong> {{ u.email }}</p>
                <p><strong>Dirección:</strong> {{ u.direccion }}</p>
                <p><strong>Documento:</strong> {{ u.numDocumento }}</p>
              </div>
              <div
                class="card-footer d-flex justify-content-end gap-2 flex-wrap"
              >
                <button
                  class="btn btn-warning btn-sm"
                  (click)="mostrarInfoUsuario(u.usersId)"
                >
                  <i class="fas fa-user-shield"></i>
                </button>
                <button
                  class="btn btn-outline-primary btn-sm"
                  (click)="editarusuarios(u, i)"
                >
                  <i class="fas fa-edit"></i>
                </button>
                <button
                  class="btn btn-outline-danger btn-sm"
                  (click)="confirmDelete(i)"
                >
                  <i class="fas fa-trash-alt"></i>
                </button>
                <button
                  class="btn btn-outline-secondary btn-sm"
                  (click)="mostrarHojaVida(u)"
                >
                  <i class="fas fa-file-alt"></i>
                </button>
                <button
                  class="btn btn-outline-secondary btn-sm"
                  (click)="verExperiencia(u)"
                >
                  <i class="fas fa-briefcase"></i>
                </button>
                <button
                  class="btn btn-outline-secondary btn-sm"
                  (click)="mostrarEstudios(u)"
                >
                  <i class="fas fa-graduation-cap"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Paginador -->
        <nav class="mt-2 d-flex justify-content-center">
          <ul class="pagination pagination-sm">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <button
                class="page-link"
                (click)="cambiarPagina(currentPage - 1)"
              >
                Anterior
              </button>
            </li>
            <li
              class="page-item"
              *ngFor="
                let paginas of getPaginas(currentPage, totalPagesFiltrados)
              "
              [class.active]="paginas === currentPage"
              [class.disabled]="paginas === '...'"
            >
              <button
                class="page-link"
                (click)="irAPaginaUsuarios(paginas)"
                [disabled]="paginas === '...'"
              >
                {{ paginas }}
              </button>
            </li>

            <li
              class="page-item"
              [class.disabled]="currentPage === totalPagesFiltrados"
            >
              <button
                class="page-link"
                (click)="cambiarPagina(currentPage + 1)"
              >
                Siguiente
              </button>
            </li>
          </ul>
        </nav>
      </div>

      <!--Targetas: visible en pantallas pequeñas  Usuarios externos-->

      <div class="d-md-none">
        <div
          id="tituloTargetas2Res"
          class="header-horas d-flex justify-content-between align-items-center"
        >
          <h3 class="mt-4">Directorio Usuarios Externos</h3>
        </div>
        <input
          id="tituloTargetasfiltro2Res"
          type="text"
          class="form-control mb-3"
          placeholder="Buscar externo por nombre..."
          style="
            background-color: #1d2233;
            color: white;
            border: 1px solid #7a86a1;
          "
          [(ngModel)]="filtroNombreExternos"
        />
        <div class="row">
          <div
            class="col-12 mb-3"
            *ngFor="
              let usuarios of usuariosRolCinco
                | filterNombre : filtroNombreExternos
                | paginate
                  : {
                      itemsPerPage: itemsPerPage,
                      currentPage: currentPageExternos
                    };
              trackBy: trackByUsuario;
              let i = index
            "
          >
            <div class="card border-info">
              <div class="card-body">
                <p><strong>Nombre:</strong> {{ nombreCompleto(usuarios) }}</p>
                <p><strong>Teléfono:</strong> {{ usuarios.telefono }}</p>
                <p><strong>Correo:</strong> {{ usuarios.email }}</p>
                <p><strong>Dirección:</strong> {{ usuarios.direccion }}</p>
                <p><strong>Documento:</strong> {{ usuarios.numDocumento }}</p>
              </div>
              <div
                class="card-footer d-flex justify-content-end gap-2 flex-wrap"
              >
                <button
                  class="btn btn-warning btn-sm"
                  (click)="mostrarInfoUsuario(usuarios.usersId)"
                >
                  <i class="fas fa-user-shield"></i>
                </button>
                <button
                  class="btn btn-outline-primary btn-sm"
                  (click)="editarusuarios(usuarios, i)"
                >
                  <i class="fas fa-edit"></i>
                </button>
                <button
                  class="btn btn-outline-danger btn-sm"
                  (click)="confirmDelete(i)"
                >
                  <i class="fas fa-trash-alt"></i>
                </button>
                <button
                  class="btn btn-outline-secondary btn-sm"
                  (click)="mostrarHojaVida(usuarios)"
                >
                  <i class="fas fa-file-alt"></i>
                </button>
                <button
                  class="btn btn-outline-secondary btn-sm"
                  (click)="verExperiencia(usuarios)"
                >
                  <i class="fas fa-briefcase"></i>
                </button>
                <button
                  class="btn btn-outline-secondary btn-sm"
                  (click)="mostrarEstudios(usuarios)"
                >
                  <i class="fas fa-graduation-cap"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Paginador Externos -->
        <nav class="mt-2 d-flex justify-content-center">
          <ul class="pagination pagination-sm">
            <li class="page-item" [class.disabled]="currentPageExternos === 1">
              <button
                class="page-link"
                (click)="currentPageExternos = currentPageExternos - 1"
              >
                Anterior
              </button>
            </li>
            <li
              class="page-item"
              *ngFor="
                let page of getPaginas(
                  currentPageExternos,
                  totalPagesExternosFiltrados
                )
              "
              [class.active]="page === currentPageExternos"
              [class.disabled]="page === '...'"
            >
              <button
                class="page-link"
                (click)="irAPaginaExternos(page)"
                [disabled]="page === '...'"
              >
                {{ page }}
              </button>
            </li>

            <li
              class="page-item"
              [class.disabled]="
                currentPageExternos === totalPagesExternosFiltrados
              "
            >
              <button
                class="page-link"
                (click)="currentPageExternos = currentPageExternos + 1"
              >
                Siguiente
              </button>
            </li>
          </ul>
        </nav>
      </div>
    </div>

    <!-- Modal Agregar -->
    <!-- Modal Agregar Usuario -->
    <div
      class="modal fade"
      id="agregarusuariosModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-scrollable modal-xl modal-70">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Agregar Usuario</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <form (ngSubmit)="agregarUsuario()" #formAgregar="ngForm">
            <div class="modal-body">
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Primer Nombre</label>
                  <input
                    class="form-control"
                    [(ngModel)]="nuevoUsuario.primerNombre"
                    name="primerNombre"
                    required
                    pattern="[a-zA-Z\s]*"
                    title="Solo letras"
                    (keypress)="soloLetras($event)"
                  />
                  <div class="invalid-feedback">
                    Este campo es obligatorio y solo permite letras
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Segundo Nombre</label>
                  <input
                    class="form-control"
                    [(ngModel)]="nuevoUsuario.segundoNombre"
                    name="segundoNombre"
                    pattern="[a-zA-Z\s]*"
                    title="Solo letras"
                    (keypress)="soloLetras($event)"
                  />
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Primer Apellido</label>
                  <input
                    class="form-control"
                    [(ngModel)]="nuevoUsuario.primerApellido"
                    name="primerApellido"
                    required
                    pattern="[a-zA-Z\s]*"
                    title="Solo letras"
                    (keypress)="soloLetras($event)"
                  />
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Segundo Apellido</label>
                  <input
                    class="form-control"
                    [(ngModel)]="nuevoUsuario.segundoApellido"
                    name="segundoApellido"
                    pattern="[a-zA-Z\s]*"
                    title="Solo letras"
                    (keypress)="soloLetras($event)"
                  />
                </div>
                <!-- Tipo de Documento -->
                <div class="col-md-4 mb-3">
                  <label class="form-label">Tipo de Documento</label>
                  <select
                    class="form-control"
                    [(ngModel)]="nuevoUsuario.tipoDocumentoId"
                    name="tipoDocumentoId"
                    required
                  >
                    <option [ngValue]="null">Seleccione un tipo</option>
                    <option
                      *ngFor="let t of tiposDocumento"
                      [value]="t.idTipoDocumento"
                    >
                      {{ t.nombreTipoDocumento }}
                    </option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Número de Documento</label>
                  <input
                    type="text"
                    class="form-control"
                    [(ngModel)]="nuevoUsuario.numDocumento"
                    name="numDocumento"
                    required
                    pattern="^[0-9]*$"
                    title="Solo números"
                    (keypress)="soloNumeros($event)"
                  />
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Fecha de Nacimiento</label>
                  <input
                    type="date"
                    class="form-control"
                    [(ngModel)]="nuevoUsuario.fechaNacimiento"
                    name="fechaNacimiento"
                    required
                  />
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Correo</label>
                  <input
                    type="email"
                    class="form-control"
                    [(ngModel)]="nuevoUsuario.email"
                    name="email"
                    required
                  />
                  <input
                    type="hidden"
                    [(ngModel)]="nuevoUsuario.email_confirmation"
                    name="email_confirmation"
                  />
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Dirección</label>
                  <input
                    class="form-control"
                    [(ngModel)]="nuevoUsuario.direccion"
                    name="direccion"
                    required
                  />
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Teléfono</label>
                  <input
                    class="form-control"
                    [(ngModel)]="nuevoUsuario.telefono"
                    name="telefono"
                    required
                  />
                </div>
                <!-- Nacionalidad -->
                <div class="col-md-4 mb-3">
                  <label class="form-label">Nacionalidad</label>
                  <select
                    class="form-control"
                    [(ngModel)]="nuevoUsuario.nacionalidadId"
                    name="nacionalidadId"
                    required
                  >
                    <option [ngValue]="null">
                      Seleccione una nacionalidad
                    </option>
                    <option
                      *ngFor="let n of nacionalidades"
                      [value]="n.idNacionalidad"
                    >
                      {{ n.nombre }}
                    </option>
                  </select>
                </div>

                <!-- EPS -->
                <div class="col-md-4 mb-3">
                  <label class="form-label">EPS</label>
                  <select
                    class="form-control"
                    [(ngModel)]="nuevoUsuario.epsCodigo"
                    name="epsCodigo"
                    required
                  >
                    <option [ngValue]="null">Seleccione una EPS</option>
                    <option *ngFor="let e of eps" [value]="e.codigoEps">
                      {{ e.nombreEps }}
                    </option>
                  </select>
                </div>

                <!-- Fondo de Pensiones -->
                <div class="col-md-4 mb-3">
                  <label class="form-label">Fondo de Pensiones</label>
                  <select
                    class="form-control"
                    [(ngModel)]="nuevoUsuario.pensionesCodigo"
                    name="pensionesCodigo"
                    required
                  >
                    <option [ngValue]="null">Seleccione un fondo</option>
                    <option
                      *ngFor="let p of pensiones"
                      [value]="p.codigoPensiones"
                    >
                      {{ p.nombrePensiones }}
                    </option>
                  </select>
                </div>

                <!-- Género -->
                <div class="col-md-4 mb-3">
                  <label class="form-label">Género</label>
                  <select
                    class="form-control"
                    [(ngModel)]="nuevoUsuario.generoId"
                    name="generoId"
                    required
                  >
                    <option [ngValue]="null">Seleccione un género</option>
                    <option *ngFor="let g of generos" [value]="g.idGenero">
                      {{ g.abreviacionGenero }}
                    </option>
                  </select>
                </div>

                <!-- Estado Civil -->
                <div class="col-md-4 mb-3">
                  <label class="form-label">Estado Civil</label>
                  <select
                    class="form-control"
                    [(ngModel)]="nuevoUsuario.estadoCivilId"
                    name="estadoCivilId"
                    required
                  >
                    <option [ngValue]="null">Seleccione un estado civil</option>
                    <option
                      *ngFor="let ec of estadosCiviles"
                      [value]="ec.idEstadoCivil"
                    >
                      {{ ec.nombreEstado }}
                    </option>
                  </select>
                </div>
                <!-- Contraseña -->
                <div class="col-md-4 mb-3">
                  <label class="form-label">Contraseña</label>
                  <input
                    type="password"
                    class="form-control"
                    [(ngModel)]="nuevoUsuario.password"
                    name="password"
                    required
                  />
                </div>

                <!-- Repetir Contraseña -->
                <div class="col-md-4 mb-3">
                  <label class="form-label">Repetir Contraseña</label>
                  <input
                    type="password"
                    class="form-control"
                    [(ngModel)]="nuevoUsuario.repetirPassword"
                    name="repetirPassword"
                    required
                  />
                </div>

                <!-- Rol -->
                <div class="col-md-4 mb-3">
                  <label class="form-label">Rol</label>
                  <select
                    class="form-control"
                    [(ngModel)]="nuevoUsuario.rol"
                    name="rol"
                    required
                  >
                    <option [ngValue]="null">Seleccione un rol</option>
                    <option *ngFor="let r of roles" [value]="r.idRol">
                      {{ r.nombreRol }}
                    </option>
                  </select>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="submit"
                class="btn btn-primary"
                [disabled]="formAgregar.invalid"
              >
                Guardar
              </button>
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancelar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Modal Editar -->
    <div
      class="modal fade"
      id="editarusuariosModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Editar usuario</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form (ngSubmit)="actualizarUsuario()" #formEditar="ngForm">
              <ng-container
                *ngTemplateOutlet="formulariousuarios"
              ></ng-container>
              <button type="submit" class="btn btn-primary">
                Guardar cambios
              </button>
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancelar
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal Hoja de Vida -->
    <div
      class="modal fade"
      id="hojaDeVidaModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Hoja de Vida</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Cerrar"
            ></button>
          </div>
          <div class="modal-body">
            <div *ngIf="hojaDeVidaSeleccionada">
              <h6 class="fw-bold">Datos Hoja de Vida</h6>
              <p>
                <strong>ID Hoja de Vida:</strong>
                {{ hojaDeVidaSeleccionada.idHojaDeVida }}
              </p>
              <p>
                <strong>Clase Libreta Militar:</strong>
                {{ hojaDeVidaSeleccionada.claseLibretaMilitar }}
              </p>
              <p>
                <strong>Número Libreta Militar:</strong>
                {{ hojaDeVidaSeleccionada.numeroLibretaMilitar }}
              </p>
              <p>
                <strong>N° Documento Usuario:</strong>
                {{ hojaDeVidaSeleccionada.usuarioNumDocumento }}
              </p>

              <hr />

              <h6 class="fw-bold">Datos del Usuario</h6>
              <p>
                <strong>Nombre:</strong>
                {{ hojaDeVidaSeleccionada.usuario?.primerNombre }}
                {{ hojaDeVidaSeleccionada.usuario?.segundoNombre }}
                {{ hojaDeVidaSeleccionada.usuario?.primerApellido }}
                {{ hojaDeVidaSeleccionada.usuario?.segundoApellido }}
              </p>
              <p>
                <strong>Email:</strong>
                {{ hojaDeVidaSeleccionada.usuario?.email }}
              </p>
              <p>
                <strong>Teléfono:</strong>
                {{ hojaDeVidaSeleccionada.usuario?.telefono }}
              </p>
              <p>
                <strong>Dirección:</strong>
                {{ hojaDeVidaSeleccionada.usuario?.direccion }}
              </p>
              <p>
                <strong>Nacionalidad:</strong>
                {{
                  hojaDeVidaSeleccionada.usuario?.nacionalidad?.nombre || "N/A"
                }}
              </p>
              <p>
                <strong>EPS:</strong>
                {{ hojaDeVidaSeleccionada.usuario?.eps?.nombreEps || "N/A" }}
              </p>
              <p>
                <strong>Género:</strong>
                {{
                  hojaDeVidaSeleccionada.usuario?.genero?.abreviacionGenero ||
                    "N/A"
                }}
              </p>
              <p>
                <strong>Tipo Documento:</strong>
                {{
                  hojaDeVidaSeleccionada.usuario?.tipo_documento
                    ?.nombreTipoDocumento || "N/A"
                }}
              </p>
              <p>
                <strong>Estado Civil:</strong>
                {{
                  hojaDeVidaSeleccionada.usuario?.estado_civil?.nombreEstado ||
                    "N/A"
                }}
              </p>
              <p>
                <strong>Pensión:</strong>
                {{
                  hojaDeVidaSeleccionada.usuario?.pensiones?.nombrePensiones ||
                    "N/A"
                }}
              </p>
            </div>
            <div *ngIf="!hojaDeVidaSeleccionada">
              <p>No se encontró información de la hoja de vida.</p>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cerrar
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal de Experiencia Laboral -->
    <div
      class="modal fade"
      id="modalExperiencia"
      tabindex="-1"
      aria-labelledby="modalExperienciaLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header bg-dark text-white">
            <h5 class="modal-title">
              Experiencia Laboral de {{ nombreCompleto(usuarioSeleccionado) }}
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Cerrar"
            ></button>
          </div>
          <div class="modal-body">
            <div
              *ngIf="experienciasLaborales.length > 0; else noHayExperiencias"
            >
              <div
                *ngFor="let exp of experienciasLaborales"
                class="card mb-3 shadow-sm"
              >
                <div class="card-body">
                  <h5 class="card-title">{{ exp.experiencia.nomEmpresa }}</h5>
                  <p class="card-text">
                    <strong>Cargo:</strong> {{ exp.experiencia.cargo }}<br />
                    <strong>Jefe Inmediato:</strong> {{ exp.experiencia.nomJefe
                    }}<br />
                    <strong>Teléfono:</strong> {{ exp.experiencia.telefono
                    }}<br />
                    <strong>Actividades:</strong>
                    {{ exp.experiencia.actividades }}<br />
                    <strong>Tiempo:</strong>
                    {{ exp.experiencia.fechaInicio }} hasta
                    {{ exp.experiencia.fechaFinalizacion }}<br />
                    <strong>Estado:</strong>
                    <span
                      class="badge"
                      [ngClass]="exp.estado ? 'bg-success' : 'bg-secondary'"
                    >
                      {{ exp.estado ? "Activo" : "Inactivo" }}
                    </span>
                  </p>
                  <div *ngIf="exp.archivo">
                    <a
                      [href]="'http://localhost:8000/storage/' + exp.archivo"
                      target="_blank"
                      class="btn btn-sm btn-outline-primary"
                    >
                      <i class="fas fa-download"></i> Descargar Certificado
                    </a>
                  </div>
                </div>
              </div>
            </div>
            <ng-template #noHayExperiencias>
              <p class="text-muted">
                Este usuario no tiene experiencias laborales registradas.
              </p>
            </ng-template>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cerrar
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal de Error de Datos -->
    <div *ngIf="experienciasLaborales.length === 0">
      <p class="text-muted">
        Este usuario no tiene experiencias laborales registradas.
      </p>
    </div>

    <!--Modal estudios-->
    <div
      class="modal fade"
      id="modalEstudios"
      tabindex="-1"
      aria-labelledby="modalEstudiosLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header bg-dark text-white">
            <h5 class="modal-title">
              Estudios de {{ nombreCompleto(usuarioSeleccionado) }}
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Cerrar"
            ></button>
          </div>
          <div class="modal-body">
            <div *ngIf="estudios.length > 0; else noHayEstudios">
              <div *ngFor="let est of estudios" class="card mb-3 shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">
                    {{
                      est.estudio?.nomInstitucion || "Institución no registrada"
                    }}
                  </h5>
                  <p class="card-text">
                    <strong>Estudio:</strong> {{ est.estudio?.nomEstudio
                    }}<br />
                    <strong>Título Obtenido:</strong>
                    {{ est.estudio?.tituloObtenido }}<br />
                    <strong>Años:</strong> {{ est.estudio?.anioInicio }} -
                    {{ est.estudio?.anioFinalizacion }}<br />
                    <strong>Estado:</strong>
                    <span
                      class="badge"
                      [ngClass]="est.estado ? 'bg-success' : 'bg-secondary'"
                    >
                      {{ est.estado ? "Activo" : "Inactivo" }}
                    </span>
                  </p>
                  <div *ngIf="est.archivo">
                    <a
                      [href]="urlEstudio(est.archivo)"
                      target="_blank"
                      class="btn btn-sm btn-outline-primary"
                    >
                      <i class="fas fa-download"></i> Descargar Certificado
                    </a>
                  </div>
                </div>
              </div>
            </div>

            <ng-template #noHayEstudios>
              <p class="text-muted">
                Este usuario no tiene estudios registrados.
              </p>
            </ng-template>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cerrar
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal para el Reporte -->
    <div
      class="modal fade"
      id="modalReporteUsuarios"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header bg-dark text-white">
            <h5 class="modal-title">Reporte de Usuarios por Rol</h5>
            <button
              type="button"
              class="btn-close"
              (click)="cerrarModalReporte()"
              aria-label="Cerrar"
            ></button>
          </div>
          <div class="modal-body">
            <canvas id="graficaRoles" width="400" height="200"></canvas>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-success" (click)="descargarExcel()">
              Descargar Excel
            </button>
            <button class="btn btn-outline-danger" (click)="descargarPDF()">
              Descargar PDF
            </button>
            <button class="btn btn-secondary" (click)="cerrarModalReporte()">
              Cerrar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Formulario reutilizable -->
    <ng-template #formulariousuarios>
      <div class="mb-3">
        <label class="form-label">Teléfono</label>
        <input
          class="form-control"
          [(ngModel)]="usuarioSeleccionado.telefono"
          name="telefono"
          (keypress)="soloNumeros($event)"
          required
        />
      </div>
      <div class="mb-3">
        <label class="form-label">Correo</label>
        <input
          class="form-control"
          [(ngModel)]="usuarioSeleccionado.email"
          name="correo"
          required
        />
      </div>
      <div class="mb-3">
        <label class="form-label">Dirección</label>
        <input
          class="form-control"
          [(ngModel)]="usuarioSeleccionado.direccion"
          name="direccion"
          required
        />
      </div>
      <!-- Rol -->
      <div class="mb-3">
        <label class="form-label">Rol</label>
        <select
          class="form-control"
          [(ngModel)]="usuarioSeleccionado.rol"
          name="rol"
          required
        >
          <option value="0">Seleccione un rol</option>
          <option *ngFor="let r of roles" [value]="r.idRol">
            {{ r.nombreRol }}
          </option>
        </select>
      </div>
    </ng-template>
  </div>
</div>
<ng-template #sinPermiso>
  <div class="alert alert-warning">
    No tienes permiso para ver esta información.
  </div>
</ng-template>
<ng-template #sinPermiso1>
  <div class="alert alert-warning">
    No tienes permiso para ver esta información.
  </div>
</ng-template>
